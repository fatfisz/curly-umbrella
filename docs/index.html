<title>LOST</title><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><style>html{background:#000}canvas{left:50%;position:fixed;transform:translate(-50%,-50%);top:50%}</style><canvas id="canvas"></canvas><script>"use strict";function t(t){return I=60/t,$=I/4,H=D.currentTime+x,N.length=0,F.length=0,H}function e(){H=null}function n(t){const e=t-H;return e<0?H:H+$*Math.floor(e/$)}function s(){return 0===N.length?null:N[N.length-1]}function r(){if(null===H)return!1;const{currentTime:t}=D,e=n(t),r=s();let a=!1;if(null===r?a=!0:r>=e+$/2||(t>=e+$/2?a=!0:r>=e-$/2||(a=!0)),a){N.push(t);const n=t-e,s=e+$-t,r=(n<s?n:-s)/($/2);Math.abs(r)<=1&&F.push(r)}return a}function a(){if(null===H)return 0;const t=D.currentTime-H;if(t<-I/2)return 0;const e=(2*((t+I)%I/I)-1)**6;return Math.max(Math.min(e,1),0)}function o(){if(null===H)return E;const{currentTime:t}=D;return N.map(e=>(e-t)*S)}function i(){if(null===H)return E;const{currentTime:t}=D;return L.map(e=>[(H+I*e-t)*S,e%4==0?1.5:1])}function l(){if(null===H)return E;let t=(H-D.currentTime)*S;return t<0&&(t%=8*I*S),z.map((e,n)=>t+4*I*S*n)}function c(t){const e=new Image;return e.src=`data:image/svg+xml;utf8,${encodeURIComponent(t)}`,e}function f(t,e){return[X*t,Y*e]}function h(t){return X*t}function u(t){return Y*t}function p(){X=window.innerWidth,Y=window.innerHeight,X=Math.min(X,Math.floor(innerHeight*j)),Y=Math.min(Y,Math.floor(X/j)),W.width=X,W.height=Y}function m(){return u(J)/4e3}function w(t,e,n,s=1){const r=m()*s,a=t.width*r,o=t.height*r,i=Math.sin(n),l=Math.cos(n);q.setTransform(l,i,-i,l,...f(U,G)),q.drawImage(t,-a/2,-e-o,a,o)}function b(){q.setTransform(1,0,0,1,0,0)}function g(){q.strokeStyle="rgba(0, 0, 0, 0.3)",q.lineWidth=2*m(),q.setLineDash([4*m(),1.5*m()])}function d(t,e){const n=Math.sin(e),s=Math.cos(e);q.beginPath(),q.setTransform(s,n,-n,s,...f(U,G)),q.moveTo(0,-t-u(1)),q.lineTo(0,u(0)),q.stroke()}function y(){q.setTransform(1,0,0,1,0,0),q.setLineDash([])}function P(){q.fillStyle="rgba(0, 0, 0, 0.5)",q.fillRect(...f(0,1-2*Q-O),...f(1,1))}function v(){q.fillStyle="#5A8FE8",q.fillRect(...f(.5-K/2,1-Q-O),...f(K,O)),q.fillStyle="#6EE86D",q.fillRect(...f(.5-K/4,1-Q-O),...f(K/2,O)),q.lineWidth=1*m(),F.slice(-V).forEach((t,e,{length:n})=>{q.beginPath();const s=(e+1+V-n)/V;q.strokeStyle=`rgba(255, 255, 255, ${s})`;const r=h(.5+K/2*t);q.moveTo(r,u(1-Q-O)),q.lineTo(r,u(1-Q)),q.stroke()})}function k(){P(),v()}function M(t){requestAnimationFrame(M),Z&&(Z=!1,p());const e=u(J+a()/500*J);q.fillStyle="#BBF3FC",q.fillRect(0,0,...f(1,1)),q.beginPath(),q.fillStyle="rgba(232, 228, 109, 0.6)",q.moveTo(...f(U,G)),q.lineTo(h(U-.03),0),q.lineTo(h(U+.03),0),q.fill(),q.beginPath(),q.fillStyle="#8BE075",q.arc(...f(U,G),e,0,C),q.fill(),g();for(const t of l())d(e,t);y();for(const[t,n]of i())w(tt,e,t,n);for(const t of o())w(et,e,t);b(),k()}function T(){for(let t=0;t<nt-1;t++){const e=it[t]&rt|it[(t+1)%nt]&at;it[t]=it[(t+st)%nt]^e>>>1,e%2!=0&&(it[t]^=ot)}}function A(){0===lt&&T();let t=it[lt];return t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,t^=t>>>18,lt=(lt+1)%nt,(t>>>0)/4294967296}function B(t,e){function n(){c=100/(e[5]*e[5]+.001),f=100/(e[6]*e[6]+.001),h=1-e[7]*e[7]*e[7]*.01,u=-e[8]*e[8]*e[8]*1e-6,e[0]||(b=.5-e[13]/2,g=5e-5*-e[14]),p=1+e[11]*e[11]*(e[11]>0?-.9:10),m=0,w=1==e[12]?0:(1-e[12])*(1-e[12])*2e4+32}var s,r,a;for(s=0;s<24;s++)e[s]=e[s]||0;e[2]<.01&&(e[2]=.01),(r=e[1]+e[2]+e[4])<.18&&(a=.18/r,e[1]*=a,e[2]*=a,e[4]*=a);var o,i,l,c,f,h,u,p,m,w,b,g,d,y,P;if(n(),o=e[1]*e[1]*1e5,i=e[2]*e[2]*1e5,l=e[4]*e[4]*1e5+12,d=3*((o+i+l)/3|0),y={buffer:null,rawData:new Float32Array(d)},function(t,s){var r=1!=e[18]||e[21],a=e[21]*e[21]*.1,d=1+3e-4*e[22],y=e[18]*e[18]*e[18]*.1,P=1+1e-4*e[19],v=1!=e[18],k=e[23]*e[23],M=e[6],T=e[16]||e[17],B=e[17]*e[17]*e[17]*.2,R=e[16]*e[16]*(e[16]<0?-1020:1020),D=e[15]?32+((1-e[15])*(1-e[15])*2e4|0):0,C=e[3],S=e[9]/2,x=e[10]*e[10]*.01,E=e[0],N=o,F=1/o,I=1/i,$=1/l,H=5/(1+e[20]*e[20]*20)*(.01+y);H>.8&&(H=.8),H=1-H;for(var L,z,W,q,j,U,G=0,J=0,K=0,O=0,Q=0,V=0,X=0,Y=0,Z=0,_=0,tt=0,et=new Array(1024),nt=new Array(32),st=et.length;st--;)et[st]=0;for(st=nt.length;st--;)nt[st]=2*A()-1;for(st=0;st<s;st++){if(G)return st;if(D&&++_>=D&&(_=0,n()),w&&++m>=w&&(w=0,c*=p),h+=u,(c*=h)>f&&(c=f,M>0&&(G=!0)),z=c,S>0&&(tt+=x,z*=1+Math.sin(tt)*S),(z|=0)<8&&(z=8),E||((b+=g)<0?b=0:b>.5&&(b=.5)),++K>N)switch(K=0,++J){case 1:N=i;break;case 2:N=l}switch(J){case 0:O=K*F;break;case 1:O=1+2*(1-K*I)*C;break;case 2:O=1-K*$;break;case 3:O=0,G=!0}T&&((W=0|(R+=B))<0?W=-W:W>1023&&(W=1023)),r&&d&&((a*=d)<1e-5?a=1e-5:a>.1&&(a=.1)),U=0;for(var rt=8;rt--;){if(++Y>=z&&(Y%=z,3==E))for(var at=nt.length;at--;)nt[at]=2*A()-1;switch(E){case 0:j=Y/z<b?.5:-.5;break;case 1:j=1-Y/z*2;break;case 2:j=.225*(((j=1.27323954*(q=6.28318531*((q=Y/z)>.5?q-1:q))+.405284735*q*q*(q<0?1:-1))<0?-1:1)*j*j-j)+j;break;case 3:j=nt[Math.abs(32*Y/z|0)]}r&&(L=X,(y*=P)<0?y=0:y>.1&&(y=.1),v?(V+=(j-X)*y,V*=H):(X=j,V=0),Q+=(X+=V)-L,j=Q*=1-a),T&&(et[Z%1024]=j,j+=et[(Z-W+1024)%1024],Z++),U+=j}U*=.125*O*k,t[st]=U>=1?1:U<=-1?-1:U}}(y.rawData,d),y.buffer=t.createBuffer(1,d,44100),"copyToChannel"in y.buffer)y.buffer.copyToChannel(y.rawData,0);else for(P=y.buffer.getChannelData(0),s=0;s<d;s++)P[s]=y.rawData[s];return y}function R(t){const e=7680-64*t;return 8363*Math.pow(2,(4608-e)/768)}var D=new AudioContext;const C=2*Math.PI,S=.08,x=C/16/S,E=[],N=[],F=[];let I,$,H=null;const L=[0,1,2,2.5,3,4,4.5,5,5.5,6.5,7],z=Array(8).fill(),W=document.getElementById("canvas"),q=W.getContext("2d"),j=16/9,U=.2,G=10,J=9.2,K=.2,O=.04,Q=.06,V=20;let X,Y,Z=!0;const _=`\n  stroke-linejoin="round"\n  stroke-width="2"\n`,tt=c(`\n  <svg xmlns="http://www.w3.org/2000/svg" width="40" height="50" viewBox="0 0 40 50">\n    <path\n      d="M15.5 44v5h10v-5m-5-43L39 44H1z"\n      fill="none"\n      stroke="rgba(0, 0, 0, 0.3)"\n      stroke-dasharray="4 1.5"\n      ${_}\n    />\n  </svg>\n`),et=c(`\n  <svg xmlns="http://www.w3.org/2000/svg" width="40" height="50" viewBox="0 0 40 50">\n    <path d="M15.5 44v5h10v-5" fill="#ba8659" stroke="#ba8659" ${_} />\n    <path d="M20.5 1L39 44H1z" fill="#64a154" stroke="#64a154" ${_} />\n  </svg>\n`);window.onresize=(()=>{Z=!0}),requestAnimationFrame(M);const nt=624,st=397,rt=2147483648,at=2147483647,ot=2567483615,it=[42];for(let t=1;t<nt;t++){const e=it[t-1]^it[t-1]>>>30;it[t]=(1812433253*((4294901760&e)>>>16)<<16)+1812433253*(65535&e)+t,it[t]>>>=0}let lt=0;class ct{constructor(t){const{buffer:e,rawData:n}=B(D,t);this.buffer=e,this.rawData=n}play(){const t=D.createBufferSource();t.buffer=this.buffer,t.connect(D.destination),t.start()}}new ct([3,,.11,.49,.34,.05,,-.24,.2,,,-1,,.45,.16,,,,.55,-.75,,,,.6]),new ct([3,,.05,.35,.03,.5,,,,,,-1,,.45,.16,,,,1,,,,,.27]),new ct([3,,.25,.49,.34,.25,,,,,,-1,,.45,.16,,,,1,,,,,.33]),new ct([0,,.16,,.16,.19,,.02,-.02,.07,1,-1,,,-.02,.01,,,1,,,,,.43]),new ct([0,.04,.4,.5497,.1838,.27,,,,,,,,,,,,,1,,,,,.45]),new ct([1,,.1341,,.1196,.382,,,,,,,,.0303,,,,,1,,,.1,,.3]);const ft=new ct([3,0,.05,.55,.2,.8,0,0,0,0,0,0,0,0,0,0,.6,-.3,.5,-1,0,.1,0,.5]),ht=new ct([3,,.11,.49,.15,.05,,-.24,.2,,,-1,,.45,.16,,,,.55,-.75,,,,.5]),ut=new ct([3,,.11,.49,.34,.05,,-.24,.2,,,-1,,.45,.16,,,,.55,-.75,,,,.6]),pt=new ct([3,,.05,.35,.03,.5,,,,,,-1,,.45,.16,,,,1,,,,,.27]),mt=new ct([3,,.25,.49,.34,.25,,,,,,-1,,.45,.16,,,,1,,,,,.33]),wt=new ct([0,,.16,,.16,.19,,.02,-.02,.07,1,-1,,,-.02,.01,,,1,,,,,.43]),bt=new ct([0,.04,.4,.5497,.1838,.27,,,,,,,,,,,,,1,,,,,.45]),gt=new ct([1,,.1341,,.1196,.382,,,,,,,,.0303,,,,,1,,,.1,,.3]),dt=(new ct([3,0,.05,.55,.2,.8,0,0,0,0,0,0,0,0,0,0,.6,-.3,.5,-1,0,.1,0,.5]),new ct([3,,.11,.49,.15,.05,,-.24,.2,,,-1,,.45,.16,,,,.55,-.75,,,,.5]),.35);class yt{constructor(t){this.data=t.rawData}init(){this.position=0,this.playbackRate=0}}class Pt{constructor({bpm:t,channels:e,startAt:n=0,loopAt:s=0}){const r=e[0],a=r.notes.length,o=r.patterns.length;for(let t=0;t<e.length;++t){const n=e[t];n.sample=new yt(n.sample)}this.bpm=t,this.channels=e,this.startAt=n,this.loopAt=s,this.notesPerPattern=a,this.patternsPerChannel=o,this.samplesPerNote=Math.round(60*D.sampleRate/(4*t)),this.sampleRatio=44100/D.sampleRate,this.bufferPosition=0,this.currentPattern=this.startAt,this.currentNote=0;for(const{sample:t}of this.channels)t.init();this.prepareAudioBuffer()}prepareAudioBuffer(){this.audioBuffer=D.createBuffer(1,this.notesPerPattern*this.patternsPerChannel*this.samplesPerNote,D.sampleRate);const t=this.audioBuffer.getChannelData(0);t.fill(0);for(let e=0;e<t.length;++e){if(this.bufferPosition%this.samplesPerNote==0){for(const{notes:t,patterns:e,sample:n}of this.channels){if(!e[this.currentPattern])continue;const s=t[this.currentNote];void 0!==s&&(0!==s?(n.position=0,n.playbackRate=R(s)/R(49)*this.sampleRatio):n.playbackRate=0)}++this.currentNote===this.notesPerPattern&&(this.currentNote=0,this.currentPattern+=1,this.currentPattern===this.patternsPerChannel&&(this.currentPattern=this.loopAt))}let n=0;for(const{sample:t}of this.channels)0!==t.playbackRate&&(n+=t.data[Math.floor(t.position)],t.position+=t.playbackRate,t.position>=t.data.length&&(t.playbackRate=0));t[e]=n*dt,this.bufferPosition+=1}}play(){const e=D.createBufferSource();return e.buffer=this.audioBuffer,e.connect(D.destination),e.loop=!0,e.loopStart=this.loopAt*this.notesPerPattern*60/(4*this.bpm),e.loopEnd=e.buffer.duration,e.start(t(this.bpm)),this.source=e,this}stop(){e(),this.source.stop(),this.source=null}}const vt=new Pt({bpm:133,channels:[{sample:ut,patterns:[1,1,1,1,1,1,1,1],notes:[61,,,,61,,,,61,,,,61,,,,61,,,,61,,,,61,,,,61,,,,]},{sample:pt,patterns:[1,1,1,1,1,1,1,1],notes:[,,61,,,,61,61,,,61,,,,61,61,,,61,,,,61,61,,,61,,,,61,61]},{sample:mt,patterns:[1,1,1,1,1,1,1,1],notes:[,,,,61,,,,,,,,61,,,,,,,,61,,,,,,,,61]},{sample:mt,patterns:[,1,,,,,,],notes:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,61,61,61]},{sample:mt,patterns:[,,,1,,1,,1],notes:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,65]},{sample:wt,patterns:[,,1,1,1,1,,],notes:[0,,44,44,0,,44,44,0,,44,44,0,,44,44,0,,42,42,0,,42,42,0,,42,42,0,,42,42]},{sample:wt,patterns:[,,1,1,1,1,,],notes:[0,,51,51,0,,51,51,0,,51,51,0,,51,51,0,,49,49,0,,49,49,0,,49,49,0,,49,49]},{sample:wt,patterns:[,,,,,,1],notes:[0,,44,44,0,,44,44,0,,44,44,0,,44,44,0,,44,44,0,,44,44,0,,44,44,0,,44,44]},{sample:wt,patterns:[,,,,,,1],notes:[0,,49,49,0,,49,49,0,,49,49,0,,49,49,0,,51,51,0,,51,51,0,,51,51,0,,51,51]},{sample:wt,patterns:[,,,,,,,1],notes:[0,,42,42,0,,42,42,0,,42,42,0,,42,42,0,,44,44,0,,44,44,0,,44,44,0,,44,44]},{sample:wt,patterns:[,,,,,,,1],notes:[0,,49,49,0,,49,49,0,,49,49,0,,49,49,0,,51,51,0,,51,51,0,,51,51,0,,51,51]},{sample:bt,patterns:[,,1,,1,,,],notes:[68,,,,63,,,,,,63,,,,68,,66,,65,,66,,63,,,,63,,61]},{sample:bt,patterns:[,,,1,,1,,],notes:[60,,,,56,,,,,,56,,60,,56,,54,,61,,63,,65,,,,65,,63]},{sample:bt,patterns:[,,,,,1,,],notes:[,61,60,0]},{sample:bt,patterns:[,,,,,,1],notes:[61,,,,68,,65,,,,61,,,,61,,56,,63,,61,,60,,,,56,,58,,60]},{sample:bt,patterns:[,,,,,,,1],notes:[66,,54,,65,,54,,63,,54,,61,,54,,60,,61,,63,,56]},{sample:gt,patterns:[,,1,1,1,1,,],notes:[44,48,51,56,51,56,60,63,60,56,60,56,51,56,51,48,42,48,51,54,51,54,60,63,60,54,60,54,51,54,51,48]},{sample:gt,patterns:[,,,,,,1],notes:[41,44,49,53,49,53,56,61,56,53,56,53,49,53,49,44,44,48,51,56,51,56,60,63,60,56,60,56,51,56,51,48]},{sample:gt,patterns:[,,,,,,,1],notes:[42,46,49,54,49,54,58,61,58,54,58,54,49,54,49,46,44,48,51,56,51,56,60,63,60,56,60,56,51,56,51,48]}],loopAt:2});let kt=!1;document.getElementById("canvas").onclick=function(){kt?vt.stop():vt.play(),kt=!kt},window.onkeydown=(({which:t})=>{67!=t&&88!=t||r()&&ft.play(),86!=t&&90!=t||r()&&ht.play()});</script>

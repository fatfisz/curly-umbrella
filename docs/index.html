<title>LOST</title><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><style>html{background:#000}canvas{left:50%;position:fixed;transform:translate(-50%,-50%);top:50%}</style><canvas id="canvas"></canvas><script>"use strict";function t(t,e,n,s){z[n].forEach((n,r)=>{n.forEach((n,a)=>{n&&$.rect(t+a*s,e+r*s,s,s)})})}function e(t,e){return[].reduce.call(t,(t,e,n)=>t+z[e][0].length,t.length-1)*e}function n(n,s,r,a,o,i){const l=String(s),c=n/5;let f=r;switch(i){case"center":f-=e(l,c)/2;break;case"right":f-=e(l,c)}$.beginPath();for(const e of l)t(f,a,e,c),f+=(1+z[e][0].length)*c;$.fillStyle=o,$.fill()}function s(t){return U=60/t,G=U/4,J=N.currentTime+L,W.length=0,j.length=0,J}function r(){J=null}function a(t){const e=t-J;return e<0?J:J+G*Math.floor(e/G)}function o(){return 0===W.length?null:W[W.length-1]}function i(){if(null===J)return!1;const{currentTime:t}=N,e=a(t),n=o();let s=!1;if(null===n?s=!0:n>=e+G/2||(t>=e+G/2?s=!0:n>=e-G/2||(s=!0)),s){W.push(t);const n=t-e,s=e+G-t,r=(n<s?n:-s)/(G/2);Math.abs(r)<=1&&j.push(r)}return s}function l(){if(null===J)return 0;const t=N.currentTime-J;if(t<-U/2)return 0;const e=(2*((t+U)%U/U)-1)**6;return Math.max(Math.min(e,1),0)}function c(){if(null===J)return q;const{currentTime:t}=N;return W.map(e=>(e-t)*H)}function f(){if(null===J)return q;const{currentTime:t}=N;return K.map(e=>[(J+U*e-t)*H,e%4==0?1.5:1])}function h(){if(null===J)return q;let t=(J-N.currentTime)*H;return t<0&&(t%=8*U*H),O.map((e,n)=>t+4*U*H*n)}function u(t){const e=new Image;return e.src=`data:image/svg+xml;utf8,${encodeURIComponent(t)}`,e}function p(t,e){return[nt*t,st*e]}function m(t){return nt*t}function w(t){return st*t}function g(){nt=window.innerWidth,st=window.innerHeight,nt=Math.min(nt,Math.floor(innerHeight*Q)),st=Math.min(st,Math.floor(nt/Q)),I.width=nt,I.height=st}function b(){return w(Y)/4e3}function d(t,e,n,s=1){const r=b()*s,a=t.width*r,o=t.height*r,i=Math.sin(n),l=Math.cos(n);$.setTransform(l,i,-i,l,...p(V,X)),$.drawImage(t,-a/2,-e-o,a,o)}function y(){$.setTransform(1,0,0,1,0,0)}function k(){$.strokeStyle="rgba(0, 0, 0, 0.3)",$.lineWidth=2*b(),$.setLineDash([4*b(),1.5*b()])}function P(t,e){const n=Math.sin(e),s=Math.cos(e);$.beginPath(),$.setTransform(s,n,-n,s,...p(V,X)),$.moveTo(0,-t-w(1)),$.lineTo(0,w(0)),$.stroke()}function v(){$.setTransform(1,0,0,1,0,0),$.setLineDash([])}function M(){$.fillStyle="rgba(0, 0, 0, 0.6)",$.fillRect(...p(0,1-2*tt-_),...p(1,1))}function T(){$.fillStyle="#5A8FE8",$.fillRect(...p(.5-Z/2,1-tt-_),...p(Z,_)),$.fillStyle="#6EE86D",$.fillRect(...p(.5-Z/4,1-tt-_),...p(Z/2,_)),$.lineWidth=1*b(),j.slice(-et).forEach((t,e,{length:n})=>{$.beginPath();const s=(e+1+et-n)/et;$.strokeStyle=`rgba(255, 255, 255, ${s})`;const r=m(.5+Z/2*t);$.moveTo(r,w(1-tt-_)),$.lineTo(r,w(1-tt)),$.stroke()})}function A(){n(w(_),`score: 9876543210`,...p(tt,1-tt-_),"#fff")}function R(){M(),T(),A()}function B(t){requestAnimationFrame(B),rt&&(rt=!1,g());const e=w(Y+l()/500*Y);$.fillStyle="#BBF3FC",$.fillRect(0,0,...p(1,1)),$.beginPath(),$.fillStyle="rgba(232, 228, 109, 0.6)",$.moveTo(...p(V,X)),$.lineTo(m(V-.03),0),$.lineTo(m(V+.03),0),$.fill(),$.beginPath(),$.fillStyle="#8BE075",$.arc(...p(V,X),e,0,F),$.fill(),k();for(const t of h())P(e,t);v();for(const[t,n]of f())d(ot,e,t,n);for(const t of c())d(it,e,t);y(),R()}function S(){for(let t=0;t<lt-1;t++){const e=pt[t]&ft|pt[(t+1)%lt]&ht;pt[t]=pt[(t+ct)%lt]^e>>>1,e%2!=0&&(pt[t]^=ut)}}function D(){0===mt&&S();let t=pt[mt];return t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,t^=t>>>18,mt=(mt+1)%lt,(t>>>0)/4294967296}function C(t,e){function n(){c=100/(e[5]*e[5]+.001),f=100/(e[6]*e[6]+.001),h=1-e[7]*e[7]*e[7]*.01,u=-e[8]*e[8]*e[8]*1e-6,e[0]||(g=.5-e[13]/2,b=5e-5*-e[14]),p=1+e[11]*e[11]*(e[11]>0?-.9:10),m=0,w=1==e[12]?0:(1-e[12])*(1-e[12])*2e4+32}var s,r,a;for(s=0;s<24;s++)e[s]=e[s]||0;e[2]<.01&&(e[2]=.01),(r=e[1]+e[2]+e[4])<.18&&(a=.18/r,e[1]*=a,e[2]*=a,e[4]*=a);var o,i,l,c,f,h,u,p,m,w,g,b,d,y,k;if(n(),o=e[1]*e[1]*1e5,i=e[2]*e[2]*1e5,l=e[4]*e[4]*1e5+12,d=3*((o+i+l)/3|0),y={buffer:null,rawData:new Float32Array(d)},function(t,s){var r=1!=e[18]||e[21],a=e[21]*e[21]*.1,d=1+3e-4*e[22],y=e[18]*e[18]*e[18]*.1,k=1+1e-4*e[19],P=1!=e[18],v=e[23]*e[23],M=e[6],T=e[16]||e[17],A=e[17]*e[17]*e[17]*.2,R=e[16]*e[16]*(e[16]<0?-1020:1020),B=e[15]?32+((1-e[15])*(1-e[15])*2e4|0):0,S=e[3],C=e[9]/2,x=e[10]*e[10]*.01,E=e[0],N=o,F=1/o,I=1/i,$=1/l,z=5/(1+e[20]*e[20]*20)*(.01+y);z>.8&&(z=.8),z=1-z;for(var H,L,q,W,j,U,G=0,J=0,K=0,O=0,Q=0,V=0,X=0,Y=0,Z=0,_=0,tt=0,et=new Array(1024),nt=new Array(32),st=et.length;st--;)et[st]=0;for(st=nt.length;st--;)nt[st]=2*D()-1;for(st=0;st<s;st++){if(G)return st;if(B&&++_>=B&&(_=0,n()),w&&++m>=w&&(w=0,c*=p),h+=u,(c*=h)>f&&(c=f,M>0&&(G=!0)),L=c,C>0&&(tt+=x,L*=1+Math.sin(tt)*C),(L|=0)<8&&(L=8),E||((g+=b)<0?g=0:g>.5&&(g=.5)),++K>N)switch(K=0,++J){case 1:N=i;break;case 2:N=l}switch(J){case 0:O=K*F;break;case 1:O=1+2*(1-K*I)*S;break;case 2:O=1-K*$;break;case 3:O=0,G=!0}T&&((q=0|(R+=A))<0?q=-q:q>1023&&(q=1023)),r&&d&&((a*=d)<1e-5?a=1e-5:a>.1&&(a=.1)),U=0;for(var rt=8;rt--;){if(++Y>=L&&(Y%=L,3==E))for(var at=nt.length;at--;)nt[at]=2*D()-1;switch(E){case 0:j=Y/L<g?.5:-.5;break;case 1:j=1-Y/L*2;break;case 2:j=.225*(((j=1.27323954*(W=6.28318531*((W=Y/L)>.5?W-1:W))+.405284735*W*W*(W<0?1:-1))<0?-1:1)*j*j-j)+j;break;case 3:j=nt[Math.abs(32*Y/L|0)]}r&&(H=X,(y*=k)<0?y=0:y>.1&&(y=.1),P?(V+=(j-X)*y,V*=z):(X=j,V=0),Q+=(X+=V)-H,j=Q*=1-a),T&&(et[Z%1024]=j,j+=et[(Z-q+1024)%1024],Z++),U+=j}U*=.125*O*v,t[st]=U>=1?1:U<=-1?-1:U}}(y.rawData,d),y.buffer=t.createBuffer(1,d,44100),"copyToChannel"in y.buffer)y.buffer.copyToChannel(y.rawData,0);else for(k=y.buffer.getChannelData(0),s=0;s<d;s++)k[s]=y.rawData[s];return y}function x(t){const e=7680-64*t;return 8363*Math.pow(2,(4608-e)/768)}function E(){St?Bt.stop():Bt.play(),St=!St}var N=new AudioContext;const F=2*Math.PI,I=document.getElementById("canvas");var $=I.getContext("2d");const z={a:[[1,1,1],[1,,1],[1,1,1],[1,,1],[1,,1]],b:[[1,1,,],[1,,1],[1,1],[1,,1],[1,1]],c:[[1,1,1],[1],[1],[1],[1,1,1]],d:[[1,1,,],[1,,1],[1,,1],[1,,1],[1,1]],e:[[1,1,1],[1],[1,1],[1],[1,1,1]],f:[[1,1,1],[1],[1,1],[1],[1]],g:[[1,1,1],[1],[1,,1],[1,,1],[1,1,1]],h:[[1,,1],[1,,1],[1,1,1],[1,,1],[1,,1]],i:[[1],[1],[1],[1],[1]],j:[[1,1,1],[,,1],[,,1],[1,,1],[,1,1]],k:[[1,,1],[1,,1],[1,1],[1,,1],[1,,1]],l:[[1,,,],[1],[1],[1],[1,1,1]],m:[[1,,,,1],[1,1,,1,1],[1,,1,,1],[1,,,,1],[1,,,,1]],n:[[1,,,1],[1,1,,1],[1,,1,1],[1,,,1],[1,,,1]],o:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],p:[[1,1,1],[1,,1],[1,1,1],[1],[1]],q:[[1,1,1,,],[1,,1],[1,,1],[1,,1],[1,1,1,1]],r:[[1,1,1],[1,,1],[1,1,1],[1,1],[1,,1]],s:[[1,1,1],[1],[1,1,1],[,,1],[1,1,1]],t:[[1,1,1],[,1],[,1],[,1],[,1]],u:[[1,,1],[1,,1],[1,,1],[1,,1],[1,1,1]],v:[[1,,1],[1,,1],[1,,1],[1,,1],[,1]],w:[[1,,,,1],[1,,,,1],[1,,1,,1],[1,,1,,1],[1,1,1,1,1]],x:[[1,,1],[1,,1],[,1],[1,,1],[1,,1]],y:[[1,,1],[1,,1],[1,1,1],[,1],[,1]],z:[[1,1,1],[,,1],[,1],[1],[1,1,1]],1:[[,,1],[,1,1],[,,1],[,,1],[,,1]],2:[[1,1,,],[,,1],[,1],[1],[1,1,1]],3:[[1,1,,],[,,1],[,1],[,,1],[1,1]],4:[[1,,,],[1],[1,,1],[1,1,1],[,,1]],5:[[1,1,1],[1],[1,1],[,,1],[1,1]],6:[[,1,,],[1],[1,1],[1,,1],[,1]],7:[[1,1,1],[,,1],[,,1],[,1],[,1]],8:[[,1,,],[1,,1],[,1],[1,,1],[,1]],9:[[,1,,],[1,,1],[,1,1],[,,1],[,1]],0:[[,1,,],[1,,1],[1,,1],[1,,1],[,1]]," ":[[,],[],[],[],[]],".":[[,],[],[],[],[1]],"!":[[1],[1],[1],[],[1]],":":[[,],[1],[],[1],[]],"-":[[,,],[],[1,1],[],[]],"/":[[,,1],[,,1],[,1],[1],[1]],"?":[[1,1,1],[,,1],[,1],[],[,1]],"%":[[1,,1],[,,1],[,1],[1],[1,,1]]},H=.08,L=F/16/H,q=[],W=[],j=[];let U,G,J=null;const K=[0,1,2,2.5,3,4,4.5,5,5.5,6.5,7],O=Array(8).fill(),Q=16/9,V=.2,X=10,Y=9.2,Z=.2,_=.04,tt=.06,et=20;let nt,st,rt=!0;const at=`\n  stroke-linejoin="round"\n  stroke-width="2"\n`,ot=u(`\n  <svg xmlns="http://www.w3.org/2000/svg" width="40" height="50" viewBox="0 0 40 50">\n    <path\n      d="M15.5 44v5h10v-5m-5-43L39 44H1z"\n      fill="none"\n      stroke="rgba(0, 0, 0, 0.3)"\n      stroke-dasharray="4 1.5"\n      ${at}\n    />\n  </svg>\n`),it=u(`\n  <svg xmlns="http://www.w3.org/2000/svg" width="40" height="50" viewBox="0 0 40 50">\n    <path d="M15.5 44v5h10v-5" fill="#ba8659" stroke="#ba8659" ${at} />\n    <path d="M20.5 1L39 44H1z" fill="#64a154" stroke="#64a154" ${at} />\n  </svg>\n`);window.onresize=(()=>{rt=!0}),requestAnimationFrame(B);const lt=624,ct=397,ft=2147483648,ht=2147483647,ut=2567483615,pt=[42];for(let t=1;t<lt;t++){const e=pt[t-1]^pt[t-1]>>>30;pt[t]=(1812433253*((4294901760&e)>>>16)<<16)+1812433253*(65535&e)+t,pt[t]>>>=0}let mt=0;class wt{constructor(t){const{buffer:e,rawData:n}=C(N,t);this.buffer=e,this.rawData=n}play(){const t=N.createBufferSource();t.buffer=this.buffer,t.connect(N.destination),t.start()}}new wt([3,,.11,.49,.34,.05,,-.24,.2,,,-1,,.45,.16,,,,.55,-.75,,,,.6]),new wt([3,,.05,.35,.03,.5,,,,,,-1,,.45,.16,,,,1,,,,,.27]),new wt([3,,.25,.49,.34,.25,,,,,,-1,,.45,.16,,,,1,,,,,.33]),new wt([0,,.16,,.16,.19,,.02,-.02,.07,1,-1,,,-.02,.01,,,1,,,,,.43]),new wt([0,.04,.4,.5497,.1838,.27,,,,,,,,,,,,,1,,,,,.45]),new wt([1,,.1341,,.1196,.382,,,,,,,,.0303,,,,,1,,,.1,,.3]);const gt=new wt([3,0,.05,.55,.2,.8,0,0,0,0,0,0,0,0,0,0,.6,-.3,.5,-1,0,.1,0,.5]),bt=new wt([3,,.11,.49,.15,.05,,-.24,.2,,,-1,,.45,.16,,,,.55,-.75,,,,.5]),dt=new wt([3,,.11,.49,.34,.05,,-.24,.2,,,-1,,.45,.16,,,,.55,-.75,,,,.6]),yt=new wt([3,,.05,.35,.03,.5,,,,,,-1,,.45,.16,,,,1,,,,,.27]),kt=new wt([3,,.25,.49,.34,.25,,,,,,-1,,.45,.16,,,,1,,,,,.33]),Pt=new wt([0,,.16,,.16,.19,,.02,-.02,.07,1,-1,,,-.02,.01,,,1,,,,,.43]),vt=new wt([0,.04,.4,.5497,.1838,.27,,,,,,,,,,,,,1,,,,,.45]),Mt=new wt([1,,.1341,,.1196,.382,,,,,,,,.0303,,,,,1,,,.1,,.3]),Tt=(new wt([3,0,.05,.55,.2,.8,0,0,0,0,0,0,0,0,0,0,.6,-.3,.5,-1,0,.1,0,.5]),new wt([3,,.11,.49,.15,.05,,-.24,.2,,,-1,,.45,.16,,,,.55,-.75,,,,.5]),.35);class At{constructor(t){this.data=t.rawData}init(){this.position=0,this.playbackRate=0}}class Rt{constructor({bpm:t,channels:e,startAt:n=0,loopAt:s=0}){const r=e[0],a=r.notes.length,o=r.patterns.length;for(let t=0;t<e.length;++t){const n=e[t];n.sample=new At(n.sample)}this.bpm=t,this.channels=e,this.startAt=n,this.loopAt=s,this.notesPerPattern=a,this.patternsPerChannel=o,this.samplesPerNote=Math.round(60*N.sampleRate/(4*t)),this.sampleRatio=44100/N.sampleRate,this.bufferPosition=0,this.currentPattern=this.startAt,this.currentNote=0;for(const{sample:t}of this.channels)t.init();this.prepareAudioBuffer()}prepareAudioBuffer(){this.audioBuffer=N.createBuffer(1,this.notesPerPattern*this.patternsPerChannel*this.samplesPerNote,N.sampleRate);const t=this.audioBuffer.getChannelData(0);t.fill(0);for(let e=0;e<t.length;++e){if(this.bufferPosition%this.samplesPerNote==0){for(const{notes:t,patterns:e,sample:n}of this.channels){if(!e[this.currentPattern])continue;const s=t[this.currentNote];void 0!==s&&(0!==s?(n.position=0,n.playbackRate=x(s)/x(49)*this.sampleRatio):n.playbackRate=0)}++this.currentNote===this.notesPerPattern&&(this.currentNote=0,this.currentPattern+=1,this.currentPattern===this.patternsPerChannel&&(this.currentPattern=this.loopAt))}let n=0;for(const{sample:t}of this.channels)0!==t.playbackRate&&(n+=t.data[Math.floor(t.position)],t.position+=t.playbackRate,t.position>=t.data.length&&(t.playbackRate=0));t[e]=n*Tt,this.bufferPosition+=1}}play(){const t=N.createBufferSource();return t.buffer=this.audioBuffer,t.connect(N.destination),t.loop=!0,t.loopStart=this.loopAt*this.notesPerPattern*60/(4*this.bpm),t.loopEnd=t.buffer.duration,t.start(s(this.bpm)),this.source=t,this}stop(){r(),this.source.stop(),this.source=null}}const Bt=new Rt({bpm:133,channels:[{sample:dt,patterns:[1,1,1,1,1,1,1,1],notes:[61,,,,61,,,,61,,,,61,,,,61,,,,61,,,,61,,,,61,,,,]},{sample:yt,patterns:[1,1,1,1,1,1,1,1],notes:[,,61,,,,61,61,,,61,,,,61,61,,,61,,,,61,61,,,61,,,,61,61]},{sample:kt,patterns:[1,1,1,1,1,1,1,1],notes:[,,,,61,,,,,,,,61,,,,,,,,61,,,,,,,,61]},{sample:kt,patterns:[,1,,,,,,],notes:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,61,61,61]},{sample:kt,patterns:[,,,1,,1,,1],notes:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,65]},{sample:Pt,patterns:[,,1,1,1,1,,],notes:[0,,44,44,0,,44,44,0,,44,44,0,,44,44,0,,42,42,0,,42,42,0,,42,42,0,,42,42]},{sample:Pt,patterns:[,,1,1,1,1,,],notes:[0,,51,51,0,,51,51,0,,51,51,0,,51,51,0,,49,49,0,,49,49,0,,49,49,0,,49,49]},{sample:Pt,patterns:[,,,,,,1],notes:[0,,44,44,0,,44,44,0,,44,44,0,,44,44,0,,44,44,0,,44,44,0,,44,44,0,,44,44]},{sample:Pt,patterns:[,,,,,,1],notes:[0,,49,49,0,,49,49,0,,49,49,0,,49,49,0,,51,51,0,,51,51,0,,51,51,0,,51,51]},{sample:Pt,patterns:[,,,,,,,1],notes:[0,,42,42,0,,42,42,0,,42,42,0,,42,42,0,,44,44,0,,44,44,0,,44,44,0,,44,44]},{sample:Pt,patterns:[,,,,,,,1],notes:[0,,49,49,0,,49,49,0,,49,49,0,,49,49,0,,51,51,0,,51,51,0,,51,51,0,,51,51]},{sample:vt,patterns:[,,1,,1,,,],notes:[68,,,,63,,,,,,63,,,,68,,66,,65,,66,,63,,,,63,,61]},{sample:vt,patterns:[,,,1,,1,,],notes:[60,,,,56,,,,,,56,,60,,56,,54,,61,,63,,65,,,,65,,63]},{sample:vt,patterns:[,,,,,1,,],notes:[,61,60,0]},{sample:vt,patterns:[,,,,,,1],notes:[61,,,,68,,65,,,,61,,,,61,,56,,63,,61,,60,,,,56,,58,,60]},{sample:vt,patterns:[,,,,,,,1],notes:[66,,54,,65,,54,,63,,54,,61,,54,,60,,61,,63,,56]},{sample:Mt,patterns:[,,1,1,1,1,,],notes:[44,48,51,56,51,56,60,63,60,56,60,56,51,56,51,48,42,48,51,54,51,54,60,63,60,54,60,54,51,54,51,48]},{sample:Mt,patterns:[,,,,,,1],notes:[41,44,49,53,49,53,56,61,56,53,56,53,49,53,49,44,44,48,51,56,51,56,60,63,60,56,60,56,51,56,51,48]},{sample:Mt,patterns:[,,,,,,,1],notes:[42,46,49,54,49,54,58,61,58,54,58,54,49,54,49,46,44,48,51,56,51,56,60,63,60,56,60,56,51,56,51,48]}],loopAt:2});let St=!1;window.onkeydown=(({which:t})=>{switch(t){case 32:E();break;case 67:case 88:i()&&gt.play();break;case 86:case 90:i()&&bt.play()}});</script>

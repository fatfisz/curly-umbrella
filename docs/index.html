<title>LOST</title><style>html{background:#000}canvas{left:50%;position:fixed;transform:translate(-50%,-50%);top:50%}</style><canvas id="canvas"qwe="w"></canvas><script>"use strict";function t(t){return D=60/t,C=M.currentTime+B,R.length=0,C}function e(){C=null}function n(){R.push(M.currentTime)}function s(){if(null===C)return 0;const t=M.currentTime-C;if(t<-D/2)return 0;const e=(2*((t+D)%D/D)-1)**6;return Math.max(Math.min(e,1),0)}function r(){if(null===C)return x;const{currentTime:t}=M;return R.map(e=>(e-t)*A)}function a(){if(null===C)return x;const{currentTime:t}=M;return N.map(e=>[(C+D*e-t)*A,e%4==0?1.5:1])}function o(){if(null===C)return x;let t=(C-M.currentTime)*A;return t<0&&(t%=8*D*A),S.map((e,n)=>t+4*D*A*n)}function i(t){const e=new Image;return e.src=`data:image/svg+xml;utf8,${encodeURIComponent(t)}`,e}function l(t,e){return[H*t,L*e]}function c(t){return H*t}function f(t){return L*t}function h(){H=window.innerWidth,L=window.innerHeight,H=Math.min(H,Math.floor(innerHeight*F)),L=Math.min(L,Math.floor(H/F)),I.width=H,I.height=L}function u(){return f(G)/4e3}function p(t,e,n,s=1){const r=u()*s,a=t.width*r,o=t.height*r,i=Math.sin(n),c=Math.cos(n);E.setTransform(c,i,-i,c,...l(q,U)),E.drawImage(t,-a/2,-e-o,a,o)}function m(){E.setTransform(1,0,0,1,0,0)}function w(){E.strokeStyle="rgba(0, 0, 0, 0.3)",E.lineWidth=2*u(),E.setLineDash([4*u(),1.5*u()])}function b(t,e){const n=Math.sin(e),s=Math.cos(e);E.beginPath(),E.setTransform(s,n,-n,s,...l(q,U)),E.moveTo(0,-t-f(1)),E.lineTo(0,f(0)),E.stroke()}function d(){E.setTransform(1,0,0,1,0,0),E.setLineDash([])}function g(t=0){requestAnimationFrame(g),${code}&($=!1,h());const e=f(G+s()/500*G);E.fillStyle="#BBF3FC",E.fillRect(0,0,...l(1,1)),E.beginPath(),E.fillStyle="rgba(232, 228, 109, 0.6)",E.moveTo(...l(q,U)),E.lineTo(c(q-.03),0),E.lineTo(c(q+.03),0),E.fill(),E.beginPath(),E.fillStyle="#8BE075",E.arc(...l(q,U),e,0,T),E.fill();for(const[t,n]of a())p(W,e,t,n);for(const t of r())p(j,e,t);m(),w();for(const t of o())b(e,t);d()}function P(){for(let t=0;t<J-1;t++){const e=X[t]&O|X[(t+1)%J]&Q;X[t]=X[(t+K)%J]^e>>>1,e%2!=0&&(X[t]^=V)}}function v(){0===Y&&P();let t=X[Y];return t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,t^=t>>>18,Y=(Y+1)%J,(t>>>0)/4294967296}function y(t,e){function n(){c=100/(e[5]*e[5]+.001),f=100/(e[6]*e[6]+.001),h=1-e[7]*e[7]*e[7]*.01,u=-e[8]*e[8]*e[8]*1e-6,e[0]||(b=.5-e[13]/2,d=5e-5*-e[14]),p=1+e[11]*e[11]*(e[11]>0?-.9:10),m=0,w=1==e[12]?0:(1-e[12])*(1-e[12])*2e4+32}var s,r,a;for(s=0;s<24;s++)e[s]=e[s]||0;e[2]<.01&&(e[2]=.01),(r=e[1]+e[2]+e[4])<.18&&(a=.18/r,e[1]*=a,e[2]*=a,e[4]*=a);var o,i,l,c,f,h,u,p,m,w,b,d,g,P,y;if(n(),o=e[1]*e[1]*1e5,i=e[2]*e[2]*1e5,l=e[4]*e[4]*1e5+12,g=3*((o+i+l)/3|0),P={buffer:null,rawData:new Float32Array(g)},function(t,s){var r=1!=e[18]||e[21],a=e[21]*e[21]*.1,g=1+3e-4*e[22],P=e[18]*e[18]*e[18]*.1,y=1+1e-4*e[19],k=1!=e[18],M=e[23]*e[23],T=e[6],A=e[16]||e[17],B=e[17]*e[17]*e[17]*.2,R=e[16]*e[16]*(e[16]<0?-1020:1020),C=e[15]?32+((1-e[15])*(1-e[15])*2e4|0):0,D=e[3],x=e[9]/2,N=e[10]*e[10]*.01,S=e[0],I=o,E=1/o,F=1/i,H=1/l,L=5/(1+e[20]*e[20]*20)*(.01+P);L>.8&&(L=.8),L=1-L;for(var $,z,W,j,q,U,G=0,J=0,K=0,O=0,Q=0,V=0,X=0,Y=0,Z=0,_=0,tt=0,et=new Array(1024),nt=new Array(32),st=et.length;st--;)et[st]=0;for(st=nt.length;st--;)nt[st]=2*v()-1;for(st=0;st<s;st++){if(G)return st;if(C&&++_>=C&&(_=0,n()),w&&++m>=w&&(w=0,c*=p),h+=u,(c*=h)>f&&(c=f,T>0&&(G=!0)),z=c,x>0&&(tt+=N,z*=1+Math.sin(tt)*x),(z|=0)<8&&(z=8),S||((b+=d)<0?b=0:b>.5&&(b=.5)),++K>I)switch(K=0,++J){case 1:I=i;break;case 2:I=l}switch(J){case 0:O=K*E;break;case 1:O=1+2*(1-K*F)*D;break;case 2:O=1-K*H;break;case 3:O=0,G=!0}A&&((W=0|(R+=B))<0?W=-W:W>1023&&(W=1023)),r&&g&&((a*=g)<1e-5?a=1e-5:a>.1&&(a=.1)),U=0;for(var rt=8;rt--;){if(++Y>=z&&(Y%=z,3==S))for(var at=nt.length;at--;)nt[at]=2*v()-1;switch(S){case 0:q=Y/z<b?.5:-.5;break;case 1:q=1-Y/z*2;break;case 2:q=.225*(((q=1.27323954*(j=6.28318531*((j=Y/z)>.5?j-1:j))+.405284735*j*j*(j<0?1:-1))<0?-1:1)*q*q-q)+q;break;case 3:q=nt[Math.abs(32*Y/z|0)]}r&&($=X,(P*=y)<0?P=0:P>.1&&(P=.1),k?(V+=(q-X)*P,V*=L):(X=q,V=0),Q+=(X+=V)-$,q=Q*=1-a),A&&(et[Z%1024]=q,q+=et[(Z-W+1024)%1024],Z++),U+=q}U*=.125*O*M,t[st]=U>=1?1:U<=-1?-1:U}}(P.rawData,g),P.buffer=t.createBuffer(1,g,44100),"copyToChannel"in P.buffer)P.buffer.copyToChannel(P.rawData,0);else for(y=P.buffer.getChannelData(0),s=0;s<g;s++)y[s]=P.rawData[s];return P}function k(t){const e=7680-64*t;return 8363*Math.pow(2,(4608-e)/768)}var M=new AudioContext;const T=2*Math.PI,A=.08,B=T/16/A,R=[];let C=null,D=null;const x=[],N=[0,1,2,2.5,3,4,4.5,5,5.5,6.5,7],S=Array(8).fill(),I=document.getElementById("canvas"),E=I.getContext("2d"),F=16/9;let H,L,$=!0;const z=`\n  stroke-linejoin="round"\n  stroke-width="2"\n`,W=i(`\n  <svg xmlns="http://www.w3.org/2000/svg" width="40" height="50" viewBox="0 0 40 50">\n    <path\n      d="M15.5 44v5h10v-5m-5-43L39 44H1z"\n      fill="none"\n      stroke="rgba(0, 0, 0, 0.3)"\n      stroke-dasharray="4 1.5"\n      ${z}\n    />\n  </svg>\n`),j=i(`\n  <svg xmlns="http://www.w3.org/2000/svg" width="40" height="50" viewBox="0 0 40 50">\n    <path d="M15.5 44v5h10v-5" fill="#ba8659" stroke="#ba8659" ${z} />\n    <path d="M20.5 1L39 44H1z" fill="#64a154" stroke="#64a154" ${z} />\n  </svg>\n`),q=.2,U=10,G=9.2;window.onresize=(()=>{$=!0});const J=624,K=397,O=2147483648,Q=2147483647,V=2567483615,X=[42];for(let t=1;t<J;t++){const e=X[t-1]^X[t-1]>>>30;X[t]=(1812433253*((4294901760&e)>>>16)<<16)+1812433253*(65535&e)+t,X[t]>>>=0}let Y=0;class Z{constructor(t){const{buffer:e,rawData:n}=y(M,t);this.buffer=e,this.rawData=n}play(){const t=M.createBufferSource();t.buffer=this.buffer,t.connect(M.destination),t.start()}}new Z([3,,.11,.49,.34,.05,,-.24,.2,,,-1,,.45,.16,,,,.55,-.75,,,,.6]),new Z([3,,.05,.35,.03,.5,,,,,,-1,,.45,.16,,,,1,,,,,.27]),new Z([3,,.25,.49,.34,.25,,,,,,-1,,.45,.16,,,,1,,,,,.33]),new Z([0,,.16,,.16,.19,,.02,-.02,.07,1,-1,,,-.02,.01,,,1,,,,,.43]),new Z([0,.04,.4,.5497,.1838,.27,,,,,,,,,,,,,1,,,,,.45]),new Z([1,,.1341,,.1196,.382,,,,,,,,.0303,,,,,1,,,.1,,.3]);const _=new Z([3,0,.05,.55,.2,.8,0,0,0,0,0,0,0,0,0,0,.6,-.3,.5,-1,0,.1,0,.5]),tt=new Z([3,,.11,.49,.15,.05,,-.24,.2,,,-1,,.45,.16,,,,.55,-.75,,,,.5]),et=new Z([3,,.11,.49,.34,.05,,-.24,.2,,,-1,,.45,.16,,,,.55,-.75,,,,.6]),nt=new Z([3,,.05,.35,.03,.5,,,,,,-1,,.45,.16,,,,1,,,,,.27]),st=new Z([3,,.25,.49,.34,.25,,,,,,-1,,.45,.16,,,,1,,,,,.33]),rt=new Z([0,,.16,,.16,.19,,.02,-.02,.07,1,-1,,,-.02,.01,,,1,,,,,.43]),at=new Z([0,.04,.4,.5497,.1838,.27,,,,,,,,,,,,,1,,,,,.45]),ot=new Z([1,,.1341,,.1196,.382,,,,,,,,.0303,,,,,1,,,.1,,.3]),it=(new Z([3,0,.05,.55,.2,.8,0,0,0,0,0,0,0,0,0,0,.6,-.3,.5,-1,0,.1,0,.5]),new Z([3,,.11,.49,.15,.05,,-.24,.2,,,-1,,.45,.16,,,,.55,-.75,,,,.5]),.35);class lt{constructor(t){this.data=t.rawData}init(){this.position=0,this.playbackRate=0}}class ct{constructor({bpm:t,channels:e,startAt:n=0,loopAt:s=0}){const r=e[0],a=r.notes.length,o=r.patterns.length;for(let t=0;t<e.length;++t){const n=e[t];n.sample=new lt(n.sample)}this.bpm=t,this.channels=e,this.startAt=n,this.loopAt=s,this.notesPerPattern=a,this.patternsPerChannel=o,this.samplesPerNote=Math.round(60*M.sampleRate/(4*t)),this.sampleRatio=44100/M.sampleRate,this.bufferPosition=0,this.currentPattern=this.startAt,this.currentNote=0;for(const{sample:t}of this.channels)t.init();this.prepareAudioBuffer()}prepareAudioBuffer(){this.audioBuffer=M.createBuffer(1,this.notesPerPattern*this.patternsPerChannel*this.samplesPerNote,M.sampleRate);const t=this.audioBuffer.getChannelData(0);t.fill(0);for(let e=0;e<t.length;++e){if(this.bufferPosition%this.samplesPerNote==0){for(const{notes:t,patterns:e,sample:n}of this.channels){if(!e[this.currentPattern])continue;const s=t[this.currentNote];void 0!==s&&(0!==s?(n.position=0,n.playbackRate=k(s)/k(49)*this.sampleRatio):n.playbackRate=0)}++this.currentNote===this.notesPerPattern&&(this.currentNote=0,this.currentPattern+=1,this.currentPattern===this.patternsPerChannel&&(this.currentPattern=this.loopAt))}let n=0;for(const{sample:t}of this.channels)0!==t.playbackRate&&(n+=t.data[Math.floor(t.position)],t.position+=t.playbackRate,t.position>=t.data.length&&(t.playbackRate=0));t[e]=n*it,this.bufferPosition+=1}}play(){const e=M.createBufferSource();return e.buffer=this.audioBuffer,e.connect(M.destination),e.loop=!0,e.loopStart=this.loopAt*this.notesPerPattern*60/(4*this.bpm),e.loopEnd=e.buffer.duration,e.start(t(this.bpm)),this.source=e,this}stop(){e(),this.source.stop(),this.source=null}}const ft=new ct({bpm:133,channels:[{sample:et,patterns:[1,1,1,1,1,1,1,1],notes:[61,,,,61,,,,61,,,,61,,,,61,,,,61,,,,61,,,,61,,,,]},{sample:nt,patterns:[1,1,1,1,1,1,1,1],notes:[,,61,,,,61,61,,,61,,,,61,61,,,61,,,,61,61,,,61,,,,61,61]},{sample:st,patterns:[1,1,1,1,1,1,1,1],notes:[,,,,61,,,,,,,,61,,,,,,,,61,,,,,,,,61]},{sample:st,patterns:[,1,,,,,,],notes:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,61,61,61]},{sample:st,patterns:[,,,1,,1,,1],notes:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,65]},{sample:rt,patterns:[,,1,1,1,1,,],notes:[0,,44,44,0,,44,44,0,,44,44,0,,44,44,0,,42,42,0,,42,42,0,,42,42,0,,42,42]},{sample:rt,patterns:[,,1,1,1,1,,],notes:[0,,51,51,0,,51,51,0,,51,51,0,,51,51,0,,49,49,0,,49,49,0,,49,49,0,,49,49]},{sample:rt,patterns:[,,,,,,1],notes:[0,,44,44,0,,44,44,0,,44,44,0,,44,44,0,,44,44,0,,44,44,0,,44,44,0,,44,44]},{sample:rt,patterns:[,,,,,,1],notes:[0,,49,49,0,,49,49,0,,49,49,0,,49,49,0,,51,51,0,,51,51,0,,51,51,0,,51,51]},{sample:rt,patterns:[,,,,,,,1],notes:[0,,42,42,0,,42,42,0,,42,42,0,,42,42,0,,44,44,0,,44,44,0,,44,44,0,,44,44]},{sample:rt,patterns:[,,,,,,,1],notes:[0,,49,49,0,,49,49,0,,49,49,0,,49,49,0,,51,51,0,,51,51,0,,51,51,0,,51,51]},{sample:at,patterns:[,,1,,1,,,],notes:[68,,,,63,,,,,,63,,,,68,,66,,65,,66,,63,,,,63,,61]},{sample:at,patterns:[,,,1,,1,,],notes:[60,,,,56,,,,,,56,,60,,56,,54,,61,,63,,65,,,,65,,63]},{sample:at,patterns:[,,,,,1,,],notes:[,61,60,0]},{sample:at,patterns:[,,,,,,1],notes:[61,,,,68,,65,,,,61,,,,61,,56,,63,,61,,60,,,,56,,58,,60]},{sample:at,patterns:[,,,,,,,1],notes:[66,,54,,65,,54,,63,,54,,61,,54,,60,,61,,63,,56]},{sample:ot,patterns:[,,1,1,1,1,,],notes:[44,48,51,56,51,56,60,63,60,56,60,56,51,56,51,48,42,48,51,54,51,54,60,63,60,54,60,54,51,54,51,48]},{sample:ot,patterns:[,,,,,,1],notes:[41,44,49,53,49,53,56,61,56,53,56,53,49,53,49,44,44,48,51,56,51,56,60,63,60,56,60,56,51,56,51,48]},{sample:ot,patterns:[,,,,,,,1],notes:[42,46,49,54,49,54,58,61,58,54,58,54,49,54,49,46,44,48,51,56,51,56,60,63,60,56,60,56,51,56,51,48]}],loopAt:2});let ht=!1;document.getElementById("canvas").onclick=function(){ht?ft.stop():ft.play(),ht=!ht},g(),window.onkeydown=(({which:t})=>{67!=t&&88!=t||(_.play(),n()),86!=t&&90!=t||(tt.play(),n())});</script>

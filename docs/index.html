<title>LOST</title><style>html{background:#000}canvas{left:50%;position:fixed;transform:translate(-50%,-50%);top:50%}</style><canvas id="canvas"qwe="w"></canvas><script>"use strict";function t(t){return B=60/t,A=y.currentTime+M}function e(){A=null}function n(){if(null===A)return 0;const t=y.currentTime-A;if(t<-B/2)return 0;const e=(2*((t+B)%B/B)-1)**6;return Math.max(Math.min(e,1),0)}function s(){if(null===A)return T;const{currentTime:t}=y;return R.map(e=>[(A+B*e-t)*v,e%4==0?1.5:1])}function a(){if(null===A)return T;let t=(A-y.currentTime)*v;return t<0&&(t%=8*B*v),C.map((e,n)=>t+4*B*v*n)}function r(t,e){return[x*t,I*e]}function o(t){return x*t}function i(t){return I*t}function l(){x=window.innerWidth,I=window.innerHeight,x=Math.min(x,Math.floor(innerHeight*S)),I=Math.min(I,Math.floor(x/S)),D.width=x,D.height=I}function c(){return i(z)/4e3}function f(t,e,n){const s=c()*n,a=F.width*s,o=F.height*s,i=Math.sin(e),l=Math.cos(e);N.setTransform(l,i,-i,l,...r(H,L)),N.drawImage(F,-a/2,-t-o,a,o)}function h(){N.setTransform(1,0,0,1,0,0)}function u(){N.strokeStyle="rgba(0, 0, 0, 0.3)",N.lineWidth=2*c(),N.setLineDash([4*c(),1.5*c()])}function p(t,e){const n=Math.sin(e),s=Math.cos(e);N.beginPath(),N.setTransform(s,n,-n,s,...r(H,L)),N.moveTo(0,-t-i(1)),N.lineTo(0,i(0)),N.stroke()}function m(){N.setTransform(1,0,0,1,0,0),N.setLineDash([])}function w(t=0){requestAnimationFrame(w),E&&(E=!1,l());const e=i(z+n()/500*z);N.fillStyle="#BBF3FC",N.fillRect(0,0,...r(1,1)),N.beginPath(),N.fillStyle="rgba(232, 228, 109, 0.6)",N.moveTo(...r(H,L)),N.lineTo(o(H-.03),0),N.lineTo(o(H+.03),0),N.fill(),N.beginPath(),N.fillStyle="#8BE075",N.arc(...r(H,L),e,0,k),N.fill();for(const[t,n]of s())f(e,t,n);h(),u();for(const t of a())p(e,t);m()}function b(){for(let t=0;t<W-1;t++){const e=G[t]&q|G[(t+1)%W]&U;G[t]=G[(t+j)%W]^e>>>1,e%2!=0&&(G[t]^=$)}}function d(){0===J&&b();let t=G[J];return t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,t^=t>>>18,J=(J+1)%W,(t>>>0)/4294967296}function g(t,e){function n(){c=100/(e[5]*e[5]+.001),f=100/(e[6]*e[6]+.001),h=1-e[7]*e[7]*e[7]*.01,u=-e[8]*e[8]*e[8]*1e-6,e[0]||(b=.5-e[13]/2,g=5e-5*-e[14]),p=1+e[11]*e[11]*(e[11]>0?-.9:10),m=0,w=1==e[12]?0:(1-e[12])*(1-e[12])*2e4+32}var s,a,r;for(s=0;s<24;s++)e[s]=e[s]||0;e[2]<.01&&(e[2]=.01),(a=e[1]+e[2]+e[4])<.18&&(r=.18/a,e[1]*=r,e[2]*=r,e[4]*=r);var o,i,l,c,f,h,u,p,m,w,b,g,P,y,k;if(n(),o=e[1]*e[1]*1e5,i=e[2]*e[2]*1e5,l=e[4]*e[4]*1e5+12,P=3*((o+i+l)/3|0),y={buffer:null,rawData:new Float32Array(P)},function(t,s){var a=1!=e[18]||e[21],r=e[21]*e[21]*.1,P=1+3e-4*e[22],y=e[18]*e[18]*e[18]*.1,k=1+1e-4*e[19],v=1!=e[18],M=e[23]*e[23],A=e[6],B=e[16]||e[17],T=e[17]*e[17]*e[17]*.2,R=e[16]*e[16]*(e[16]<0?-1020:1020),C=e[15]?32+((1-e[15])*(1-e[15])*2e4|0):0,D=e[3],N=e[9]/2,S=e[10]*e[10]*.01,x=e[0],I=o,E=1/o,F=1/i,H=1/l,L=5/(1+e[20]*e[20]*20)*(.01+y);L>.8&&(L=.8),L=1-L;for(var z,W,j,q,U,$,G=0,J=0,K=0,O=0,Q=0,V=0,X=0,Y=0,Z=0,_=0,tt=0,et=new Array(1024),nt=new Array(32),st=et.length;st--;)et[st]=0;for(st=nt.length;st--;)nt[st]=2*d()-1;for(st=0;st<s;st++){if(G)return st;if(C&&++_>=C&&(_=0,n()),w&&++m>=w&&(w=0,c*=p),h+=u,(c*=h)>f&&(c=f,A>0&&(G=!0)),W=c,N>0&&(tt+=S,W*=1+Math.sin(tt)*N),(W|=0)<8&&(W=8),x||((b+=g)<0?b=0:b>.5&&(b=.5)),++K>I)switch(K=0,++J){case 1:I=i;break;case 2:I=l}switch(J){case 0:O=K*E;break;case 1:O=1+2*(1-K*F)*D;break;case 2:O=1-K*H;break;case 3:O=0,G=!0}B&&((j=0|(R+=T))<0?j=-j:j>1023&&(j=1023)),a&&P&&((r*=P)<1e-5?r=1e-5:r>.1&&(r=.1)),$=0;for(var at=8;at--;){if(++Y>=W&&(Y%=W,3==x))for(var rt=nt.length;rt--;)nt[rt]=2*d()-1;switch(x){case 0:U=Y/W<b?.5:-.5;break;case 1:U=1-Y/W*2;break;case 2:U=.225*(((U=1.27323954*(q=6.28318531*((q=Y/W)>.5?q-1:q))+.405284735*q*q*(q<0?1:-1))<0?-1:1)*U*U-U)+U;break;case 3:U=nt[Math.abs(32*Y/W|0)]}a&&(z=X,(y*=k)<0?y=0:y>.1&&(y=.1),v?(V+=(U-X)*y,V*=L):(X=U,V=0),Q+=(X+=V)-z,U=Q*=1-r),B&&(et[Z%1024]=U,U+=et[(Z-j+1024)%1024],Z++),$+=U}$*=.125*O*M,t[st]=$>=1?1:$<=-1?-1:$}}(y.rawData,P),y.buffer=t.createBuffer(1,P,44100),"copyToChannel"in y.buffer)y.buffer.copyToChannel(y.rawData,0);else for(k=y.buffer.getChannelData(0),s=0;s<P;s++)k[s]=y.rawData[s];return y}function P(t){const e=7680-64*t;return 8363*Math.pow(2,(4608-e)/768)}var y=new AudioContext;const k=2*Math.PI,v=.08,M=k/16/v;let A=null,B=null;const T=[],R=[0,1,2,2.5,3,4,4.5,5,5.5,6.5,7],C=Array(8).fill(),D=document.getElementById("canvas"),N=D.getContext("2d"),S=16/9;let x,I,E=!0;const F=function(t){const e=new Image;return e.src=`data:image/svg+xml;utf8,${encodeURIComponent(t)}`,e}(`\n  <svg xmlns="http://www.w3.org/2000/svg" width="40" height="50" viewBox="0 0 40 50">\n    <path\n      d="M15.5 44v5h10v-5m-5-43L39 44H1z"\n      fill="none"\n      stroke="rgba(0, 0, 0, 0.3)"\n      stroke-dasharray="4 1.5"\n      stroke-linejoin="round"\n      stroke-width="2"\n    />\n  </svg>\n`),H=.2,L=10,z=9.2;window.onresize=(()=>{E=!0});const W=624,j=397,q=2147483648,U=2147483647,$=2567483615,G=[42];for(let t=1;t<W;t++){const e=G[t-1]^G[t-1]>>>30;G[t]=(1812433253*((4294901760&e)>>>16)<<16)+1812433253*(65535&e)+t,G[t]>>>=0}let J=0;class K{constructor(t){const{buffer:e,rawData:n}=g(y,t);this.buffer=e,this.rawData=n}play(){const t=y.createBufferSource();t.buffer=this.buffer,t.connect(y.destination),t.start()}}new K([3,,.11,.49,.34,.05,,-.24,.2,,,-1,,.45,.16,,,,.55,-.75,,,,.6]),new K([3,,.05,.35,.03,.5,,,,,,-1,,.45,.16,,,,1,,,,,.27]),new K([3,,.25,.49,.34,.25,,,,,,-1,,.45,.16,,,,1,,,,,.33]),new K([0,,.16,,.16,.19,,.02,-.02,.07,1,-1,,,-.02,.01,,,1,,,,,.43]),new K([0,.04,.4,.5497,.1838,.27,,,,,,,,,,,,,1,,,,,.45]),new K([1,,.1341,,.1196,.382,,,,,,,,.0303,,,,,1,,,.1,,.3]);const O=new K([3,0,.05,.55,.2,.8,0,0,0,0,0,0,0,0,0,0,.6,-.3,.5,-1,0,.1,0,.5]),Q=new K([3,,.11,.49,.15,.05,,-.24,.2,,,-1,,.45,.16,,,,.55,-.75,,,,.5]),V=new K([3,,.11,.49,.34,.05,,-.24,.2,,,-1,,.45,.16,,,,.55,-.75,,,,.6]),X=new K([3,,.05,.35,.03,.5,,,,,,-1,,.45,.16,,,,1,,,,,.27]),Y=new K([3,,.25,.49,.34,.25,,,,,,-1,,.45,.16,,,,1,,,,,.33]),Z=new K([0,,.16,,.16,.19,,.02,-.02,.07,1,-1,,,-.02,.01,,,1,,,,,.43]),_=new K([0,.04,.4,.5497,.1838,.27,,,,,,,,,,,,,1,,,,,.45]),tt=new K([1,,.1341,,.1196,.382,,,,,,,,.0303,,,,,1,,,.1,,.3]),et=(new K([3,0,.05,.55,.2,.8,0,0,0,0,0,0,0,0,0,0,.6,-.3,.5,-1,0,.1,0,.5]),new K([3,,.11,.49,.15,.05,,-.24,.2,,,-1,,.45,.16,,,,.55,-.75,,,,.5]),.35);class nt{constructor(t){this.data=t.rawData}init(){this.position=0,this.playbackRate=0}}class st{constructor({bpm:t,channels:e,startAt:n=0,loopAt:s=0}){const a=e[0],r=a.notes.length,o=a.patterns.length;for(let t=0;t<e.length;++t){const n=e[t];n.sample=new nt(n.sample)}this.bpm=t,this.channels=e,this.startAt=n,this.loopAt=s,this.notesPerPattern=r,this.patternsPerChannel=o,this.samplesPerNote=Math.round(60*y.sampleRate/(4*t)),this.sampleRatio=44100/y.sampleRate,this.bufferPosition=0,this.currentPattern=this.startAt,this.currentNote=0;for(const{sample:t}of this.channels)t.init();this.prepareAudioBuffer()}prepareAudioBuffer(){this.audioBuffer=y.createBuffer(1,this.notesPerPattern*this.patternsPerChannel*this.samplesPerNote,y.sampleRate);const t=this.audioBuffer.getChannelData(0);t.fill(0);for(let e=0;e<t.length;++e){if(this.bufferPosition%this.samplesPerNote==0){for(const{notes:t,patterns:e,sample:n}of this.channels){if(!e[this.currentPattern])continue;const s=t[this.currentNote];void 0!==s&&(0!==s?(n.position=0,n.playbackRate=P(s)/P(49)*this.sampleRatio):n.playbackRate=0)}++this.currentNote===this.notesPerPattern&&(this.currentNote=0,this.currentPattern+=1,this.currentPattern===this.patternsPerChannel&&(this.currentPattern=this.loopAt))}let n=0;for(const{sample:t}of this.channels)0!==t.playbackRate&&(n+=t.data[Math.floor(t.position)],t.position+=t.playbackRate,t.position>=t.data.length&&(t.playbackRate=0));t[e]=n*et,this.bufferPosition+=1}}play(){const e=y.createBufferSource();return e.buffer=this.audioBuffer,e.connect(y.destination),e.loop=!0,e.loopStart=this.loopAt*this.notesPerPattern*60/(4*this.bpm),e.loopEnd=e.buffer.duration,e.start(t(this.bpm)),this.source=e,this}stop(){e(),this.source.stop(),this.source=null}}const at=new st({bpm:133,channels:[{sample:V,patterns:[1,1,1,1,1,1,1,1],notes:[61,,,,61,,,,61,,,,61,,,,61,,,,61,,,,61,,,,61,,,,]},{sample:X,patterns:[1,1,1,1,1,1,1,1],notes:[,,61,,,,61,61,,,61,,,,61,61,,,61,,,,61,61,,,61,,,,61,61]},{sample:Y,patterns:[1,1,1,1,1,1,1,1],notes:[,,,,61,,,,,,,,61,,,,,,,,61,,,,,,,,61]},{sample:Y,patterns:[,1,,,,,,],notes:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,61,61,61]},{sample:Y,patterns:[,,,1,,1,,1],notes:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,65]},{sample:Z,patterns:[,,1,1,1,1,,],notes:[0,,44,44,0,,44,44,0,,44,44,0,,44,44,0,,42,42,0,,42,42,0,,42,42,0,,42,42]},{sample:Z,patterns:[,,1,1,1,1,,],notes:[0,,51,51,0,,51,51,0,,51,51,0,,51,51,0,,49,49,0,,49,49,0,,49,49,0,,49,49]},{sample:Z,patterns:[,,,,,,1],notes:[0,,44,44,0,,44,44,0,,44,44,0,,44,44,0,,44,44,0,,44,44,0,,44,44,0,,44,44]},{sample:Z,patterns:[,,,,,,1],notes:[0,,49,49,0,,49,49,0,,49,49,0,,49,49,0,,51,51,0,,51,51,0,,51,51,0,,51,51]},{sample:Z,patterns:[,,,,,,,1],notes:[0,,42,42,0,,42,42,0,,42,42,0,,42,42,0,,44,44,0,,44,44,0,,44,44,0,,44,44]},{sample:Z,patterns:[,,,,,,,1],notes:[0,,49,49,0,,49,49,0,,49,49,0,,49,49,0,,51,51,0,,51,51,0,,51,51,0,,51,51]},{sample:_,patterns:[,,1,,1,,,],notes:[68,,,,63,,,,,,63,,,,68,,66,,65,,66,,63,,,,63,,61]},{sample:_,patterns:[,,,1,,1,,],notes:[60,,,,56,,,,,,56,,60,,56,,54,,61,,63,,65,,,,65,,63]},{sample:_,patterns:[,,,,,1,,],notes:[,61,60,0]},{sample:_,patterns:[,,,,,,1],notes:[61,,,,68,,65,,,,61,,,,61,,56,,63,,61,,60,,,,56,,58,,60]},{sample:_,patterns:[,,,,,,,1],notes:[66,,54,,65,,54,,63,,54,,61,,54,,60,,61,,63,,56]},{sample:tt,patterns:[,,1,1,1,1,,],notes:[44,48,51,56,51,56,60,63,60,56,60,56,51,56,51,48,42,48,51,54,51,54,60,63,60,54,60,54,51,54,51,48]},{sample:tt,patterns:[,,,,,,1],notes:[41,44,49,53,49,53,56,61,56,53,56,53,49,53,49,44,44,48,51,56,51,56,60,63,60,56,60,56,51,56,51,48]},{sample:tt,patterns:[,,,,,,,1],notes:[42,46,49,54,49,54,58,61,58,54,58,54,49,54,49,46,44,48,51,56,51,56,60,63,60,56,60,56,51,56,51,48]}],loopAt:2});let rt=!1;document.getElementById("canvas").onclick=function(){rt?at.stop():at.play(),rt=!rt},w(),window.onkeydown=(({which:t})=>{67!=t&&88!=t||O.play(),86!=t&&90!=t||Q.play()});</script>

<title>LOST</title><style>html{background:#000}canvas{left:50%;position:fixed;transform:translate(-50%,-50%);top:50%}</style><canvas id="canvas"qwe="w"></canvas><script>"use strict";function t(t){return T=60/t,A=v.currentTime+M}function e(){A=null}function n(){if(null===A)return 0;const t=v.currentTime-A;if(t<-T/2)return 0;const e=(2*((t+T)%T/T)-1)**6;return Math.max(Math.min(e,1),0)}function s(){if(null===A)return B;const{currentTime:t}=v;return R.map(e=>[(A+T*e-t)*k,e%4==0?1.5:1])}function r(){if(null===A)return B;let t=(A-v.currentTime)*k;return t<0&&(t%=8*T*k),S.map((e,n)=>t+4*T*k*n)}function a(t,e){return[x*t,I*e]}function o(t){return x*t}function i(t){return I*t}function l(){x=window.innerWidth,I=window.innerHeight,x=Math.min(x,Math.floor(innerHeight*N)),I=Math.min(I,Math.floor(x/N)),C.width=x,C.height=I}function c(){return i(L)/4e3}function h(t,e,n){const s=c()*n,r=F.width*s,o=F.height*s,i=Math.sin(e),l=Math.cos(e);D.setTransform(l,i,-i,l,...a(H,z)),D.drawImage(F,-r/2,-t-o,r,o)}function u(){D.setTransform(1,0,0,1,0,0)}function f(){D.strokeStyle="rgba(0, 0, 0, 0.3)",D.lineWidth=2*c(),D.setLineDash([4*c(),1.5*c()])}function p(t,e){const n=Math.sin(e),s=Math.cos(e);D.beginPath(),D.setTransform(s,n,-n,s,...a(H,z)),D.moveTo(0,-t-i(1)),D.lineTo(0,i(0)),D.stroke()}function m(){D.setTransform(1,0,0,1,0,0),D.setLineDash([])}function w(t=0){requestAnimationFrame(w),E&&(E=!1,l());const e=i(L+n()/500*L);D.fillStyle="#BBF3FC",D.fillRect(0,0,...a(1,1)),D.beginPath(),D.fillStyle="rgba(232, 228, 109, 0.6)",D.moveTo(...a(H,z)),D.lineTo(o(H-.03),0),D.lineTo(o(H+.03),0),D.fill(),D.beginPath(),D.fillStyle="#8BE075",D.arc(...a(H,z),e,0,y),D.fill();for(const[t,n]of s())h(e,t,n);u(),f();for(const t of r())p(e,t);m()}function g(){for(let t=0;t<W-1;t++){const e=G[t]&q|G[(t+1)%W]&U;G[t]=G[(t+j)%W]^e>>>1,e%2!=0&&(G[t]^=$)}}function b(){0===J&&g();let t=G[J];return t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,t^=t>>>18,J=(J+1)%W,(t>>>0)/4294967296}function d(t,e){function n(){c=100/(e[5]*e[5]+.001),h=100/(e[6]*e[6]+.001),u=1-e[7]*e[7]*e[7]*.01,f=-e[8]*e[8]*e[8]*1e-6,e[0]||(g=.5-e[13]/2,d=5e-5*-e[14]),p=1+e[11]*e[11]*(e[11]>0?-.9:10),m=0,w=1==e[12]?0:(1-e[12])*(1-e[12])*2e4+32}var s,r,a;for(s=0;s<24;s++)e[s]=e[s]||0;e[2]<.01&&(e[2]=.01),(r=e[1]+e[2]+e[4])<.18&&(a=.18/r,e[1]*=a,e[2]*=a,e[4]*=a);var o,i,l,c,h,u,f,p,m,w,g,d,P,v,y;if(n(),o=e[1]*e[1]*1e5,i=e[2]*e[2]*1e5,l=e[4]*e[4]*1e5+12,P=3*((o+i+l)/3|0),v={buffer:null,rawData:new Float32Array(P)},function(t,s){var r=1!=e[18]||e[21],a=e[21]*e[21]*.1,P=1+3e-4*e[22],v=e[18]*e[18]*e[18]*.1,y=1+1e-4*e[19],k=1!=e[18],M=e[23]*e[23],A=e[6],T=e[16]||e[17],B=e[17]*e[17]*e[17]*.2,R=e[16]*e[16]*(e[16]<0?-1020:1020),S=e[15]?32+((1-e[15])*(1-e[15])*2e4|0):0,C=e[3],D=e[9]/2,N=e[10]*e[10]*.01,x=e[0],I=o,E=1/o,F=1/i,H=1/l,z=5/(1+e[20]*e[20]*20)*(.01+v);z>.8&&(z=.8),z=1-z;for(var L,W,j,q,U,$,G=0,J=0,K=0,O=0,Q=0,V=0,X=0,Y=0,Z=0,_=0,tt=0,et=new Array(1024),nt=new Array(32),st=et.length;st--;)et[st]=0;for(st=nt.length;st--;)nt[st]=2*b()-1;for(st=0;st<s;st++){if(G)return st;if(S&&++_>=S&&(_=0,n()),w&&++m>=w&&(w=0,c*=p),u+=f,(c*=u)>h&&(c=h,A>0&&(G=!0)),W=c,D>0&&(tt+=N,W*=1+Math.sin(tt)*D),(W|=0)<8&&(W=8),x||((g+=d)<0?g=0:g>.5&&(g=.5)),++K>I)switch(K=0,++J){case 1:I=i;break;case 2:I=l}switch(J){case 0:O=K*E;break;case 1:O=1+2*(1-K*F)*C;break;case 2:O=1-K*H;break;case 3:O=0,G=!0}T&&((j=0|(R+=B))<0?j=-j:j>1023&&(j=1023)),r&&P&&((a*=P)<1e-5?a=1e-5:a>.1&&(a=.1)),$=0;for(var rt=8;rt--;){if(++Y>=W&&(Y%=W,3==x))for(var at=nt.length;at--;)nt[at]=2*b()-1;switch(x){case 0:U=Y/W<g?.5:-.5;break;case 1:U=1-Y/W*2;break;case 2:U=.225*(((U=1.27323954*(q=6.28318531*((q=Y/W)>.5?q-1:q))+.405284735*q*q*(q<0?1:-1))<0?-1:1)*U*U-U)+U;break;case 3:U=nt[Math.abs(32*Y/W|0)]}r&&(L=X,(v*=y)<0?v=0:v>.1&&(v=.1),k?(V+=(U-X)*v,V*=z):(X=U,V=0),Q+=(X+=V)-L,U=Q*=1-a),T&&(et[Z%1024]=U,U+=et[(Z-j+1024)%1024],Z++),$+=U}$*=.125*O*M,t[st]=$>=1?1:$<=-1?-1:$}}(v.rawData,P),v.buffer=t.createBuffer(1,P,44100),"copyToChannel"in v.buffer)v.buffer.copyToChannel(v.rawData,0);else for(y=v.buffer.getChannelData(0),s=0;s<P;s++)y[s]=v.rawData[s];return v}function P(t){const e=7680-64*t;return 8363*Math.pow(2,(4608-e)/768)}var v=new AudioContext;const y=2*Math.PI,k=.08,M=y/16/k;let A=null,T=null;const B=[],R=[0,1,2,2.5,3,4,4.5,5,5.5,6.5,7],S=Array(8).fill(),C=document.getElementById("canvas"),D=C.getContext("2d"),N=16/9;let x,I,E=!0;const F=function(t){const e=new Image;return e.src=`data:image/svg+xml;utf8,${encodeURIComponent(t)}`,e}(`\n  <svg xmlns="http://www.w3.org/2000/svg" width="41" height="56" viewBox="0 0 41 56">\n    <path\n      d="M15.5 50.5v5h10v-5m-5-50l20 50H.5z"\n      fill="none"\n      stroke="rgba(0, 0, 0, 0.3)"\n      stroke-dasharray="4 1.5"\n      stroke-linejoin="round"\n      stroke-width="2"\n    />\n  </svg>\n`),H=.2,z=10,L=9.2;window.onresize=(()=>{E=!0});const W=624,j=397,q=2147483648,U=2147483647,$=2567483615,G=[42];for(let t=1;t<W;t++){const e=G[t-1]^G[t-1]>>>30;G[t]=(1812433253*((4294901760&e)>>>16)<<16)+1812433253*(65535&e)+t,G[t]>>>=0}let J=0;class K{constructor(t){const{buffer:e,rawData:n}=d(v,t);this.buffer=e,this.rawData=n}}const O=.35;class Q{constructor(t){this.data=t.rawData}init(){this.position=0,this.playbackRate=0}}class V{constructor({bpm:t,channels:e,startAt:n=0,loopAt:s=0}){const r=e[0],a=r.notes.length,o=r.patterns.length;for(let t=0;t<e.length;++t){const n=e[t];n.sample=new Q(n.sample)}this.bpm=t,this.channels=e,this.startAt=n,this.loopAt=s,this.notesPerPattern=a,this.patternsPerChannel=o,this.samplesPerNote=Math.round(60*v.sampleRate/(4*t)),this.sampleRatio=44100/v.sampleRate,this.bufferPosition=0,this.currentPattern=this.startAt,this.currentNote=0;for(const{sample:t}of this.channels)t.init();this.prepareAudioBuffer()}prepareAudioBuffer(){this.audioBuffer=v.createBuffer(1,this.notesPerPattern*this.patternsPerChannel*this.samplesPerNote,v.sampleRate);const t=this.audioBuffer.getChannelData(0);t.fill(0);for(let e=0;e<t.length;++e){if(this.bufferPosition%this.samplesPerNote==0){for(const{notes:t,patterns:e,sample:n}of this.channels){if(!e[this.currentPattern])continue;const s=t[this.currentNote];void 0!==s&&(0!==s?(n.position=0,n.playbackRate=P(s)/P(49)*this.sampleRatio):n.playbackRate=0)}++this.currentNote===this.notesPerPattern&&(this.currentNote=0,this.currentPattern+=1,this.currentPattern===this.patternsPerChannel&&(this.currentPattern=this.loopAt))}let n=0;for(const{sample:t}of this.channels)0!==t.playbackRate&&(n+=t.data[Math.floor(t.position)],t.position+=t.playbackRate,t.position>=t.data.length&&(t.playbackRate=0));t[e]=n*O,this.bufferPosition+=1}}start(){const e=v.createBufferSource();return e.buffer=this.audioBuffer,e.connect(v.destination),e.loop=!0,e.loopStart=this.loopAt*this.notesPerPattern*60/(4*this.bpm),e.loopEnd=e.buffer.duration,e.start(t(this.bpm)),this.source=e,this}stop(){e(),this.source.stop(),this.source.disconnect(v.destination),this.source=null}}const X=new K([3,,.11,.49,.34,.05,,-.24,.2,,,-1,,.45,.16,,,,.55,-.75,,,,.6]),Y=new K([3,,.05,.35,.03,.5,,,,,,-1,,.45,.16,,,,1,,,,,.27]),Z=new K([3,,.25,.49,.34,.25,,,,,,-1,,.45,.16,,,,1,,,,,.33]),_=new K([0,,.16,,.16,.19,,.02,-.02,.07,1,-1,,,-.02,.01,,,1,,,,,.43]),tt=new K([0,.04,.4,.5497,.1838,.27,,,,,,,,,,,,,1,,,,,.45]),et=new K([1,,.1341,,.1196,.382,,,,,,,,.0303,,,,,1,,,.1,,.3]);var nt={level1:new V({bpm:133,channels:[{sample:X,patterns:[1,1,1,1,1,1,1,1],notes:[61,,,,61,,,,61,,,,61,,,,61,,,,61,,,,61,,,,61,,,,]},{sample:Y,patterns:[1,1,1,1,1,1,1,1],notes:[,,61,,,,61,61,,,61,,,,61,61,,,61,,,,61,61,,,61,,,,61,61]},{sample:Z,patterns:[1,1,1,1,1,1,1,1],notes:[,,,,61,,,,,,,,61,,,,,,,,61,,,,,,,,61]},{sample:Z,patterns:[,1,,,,,,],notes:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,61,61,61]},{sample:Z,patterns:[,,,1,,1,,1],notes:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,65]},{sample:_,patterns:[,,1,1,1,1,,],notes:[0,,44,44,0,,44,44,0,,44,44,0,,44,44,0,,42,42,0,,42,42,0,,42,42,0,,42,42]},{sample:_,patterns:[,,1,1,1,1,,],notes:[0,,51,51,0,,51,51,0,,51,51,0,,51,51,0,,49,49,0,,49,49,0,,49,49,0,,49,49]},{sample:_,patterns:[,,,,,,1],notes:[0,,44,44,0,,44,44,0,,44,44,0,,44,44,0,,44,44,0,,44,44,0,,44,44,0,,44,44]},{sample:_,patterns:[,,,,,,1],notes:[0,,49,49,0,,49,49,0,,49,49,0,,49,49,0,,51,51,0,,51,51,0,,51,51,0,,51,51]},{sample:_,patterns:[,,,,,,,1],notes:[0,,42,42,0,,42,42,0,,42,42,0,,42,42,0,,44,44,0,,44,44,0,,44,44,0,,44,44]},{sample:_,patterns:[,,,,,,,1],notes:[0,,49,49,0,,49,49,0,,49,49,0,,49,49,0,,51,51,0,,51,51,0,,51,51,0,,51,51]},{sample:tt,patterns:[,,1,,1,,,],notes:[68,,,,63,,,,,,63,,,,68,,66,,65,,66,,63,,,,63,,61]},{sample:tt,patterns:[,,,1,,1,,],notes:[60,,,,56,,,,,,56,,60,,56,,54,,61,,63,,65,,,,65,,63]},{sample:tt,patterns:[,,,,,1,,],notes:[,61,60,0]},{sample:tt,patterns:[,,,,,,1],notes:[61,,,,68,,65,,,,61,,,,61,,56,,63,,61,,60,,,,56,,58,,60]},{sample:tt,patterns:[,,,,,,,1],notes:[66,,54,,65,,54,,63,,54,,61,,54,,60,,61,,63,,56]},{sample:et,patterns:[,,1,1,1,1,,],notes:[44,48,51,56,51,56,60,63,60,56,60,56,51,56,51,48,42,48,51,54,51,54,60,63,60,54,60,54,51,54,51,48]},{sample:et,patterns:[,,,,,,1],notes:[41,44,49,53,49,53,56,61,56,53,56,53,49,53,49,44,44,48,51,56,51,56,60,63,60,56,60,56,51,56,51,48]},{sample:et,patterns:[,,,,,,,1],notes:[42,46,49,54,49,54,58,61,58,54,58,54,49,54,49,46,44,48,51,56,51,56,60,63,60,56,60,56,51,56,51,48]}],loopAt:2})};class st{constructor(){this.currentSong=null}playSong(t){const e=nt[t];this.currentSong!==e&&(this.currentSong=e.start())}stop(){this.currentSong.stop(),this.currentSong=null}}const rt=new st;let at=!1;document.getElementById("canvas").onclick=function(){at?rt.stop():rt.playSong("level1"),at=!at},w();</script>
